\documentclass{article}

% Packages
\usepackage[ngerman]{babel} % For German language support
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc} % For proper font encoding
\usepackage{graphicx} % For including graphics
\usepackage{multibib}
\usepackage[a4paper, margin=3cm]{geometry} % Set border to 2 cm
\usepackage{tabularx}
\usepackage{array}
\newcolumntype{Y}{>{\centering\arraybackslash\hsize=0.90\hsize}X}
\newcolumntype{C}{>{\centering\arraybackslash\hsize=1\hsize}X}
\newcolumntype{Z}{>{\centering\arraybackslash\hsize=1.15\hsize}X}
\usepackage{xcolor}
\usepackage{float}
\usepackage{hyperref}
\usepackage{tocloft} % Für Anpassung des Abbildungsverzeichnisses
\usepackage{amsmath} % For advanced math formatting
% \usepackage{url}

\setlength{\parindent}{0pt} % No indentation for paragraphs

% Seitenzahlen ab Inhaltsverzeichnis in römischen Zahlen
\pagenumbering{roman}

\begin{document}

% Titelseite ohne Seitenzahl
\thispagestyle{empty}
\input{cover.tex}

\renewcommand{\abstractname}{Abstract}
\begin{abstract}
Die vorliegende Arbeit beschäftigt sich mit der Entwicklung, Umsetzung und Validierung eines energieeffizienten 
Hardwareprototyps zur digitalen Darstellung von Raumbelegungsplänen an der Hochschule für Technik und Wirtschaft 
Berlin (HTW). Ausgangspunkt ist die Problematik, dass die bisherigen Papieraushänge nur zu Semesterbeginn 
aktualisiert werden und keine Möglichkeit zur Echtzeitaktualisierung bieten. Ziel der Arbeit ist es, durch den 
Einsatz von E-Ink-Displays und die Auswahl optimierter Hardwarekomponenten eine signifikante Verlängerung der 
Betriebsdauer im Vergleich zu bisherigen Prototypen zu erreichen und den Wartungsaufwand zu minimieren.

Im Rahmen einer umfassenden Analyse wurden bestehende Projekte an der HTW untersucht, deren Hardware- und 
Softwarearchitekturen verglichen und deren Laufzeiten bewertet. Darauf aufbauend erfolgte die Konzeption 
eines neuen Prototyps, bei dem insbesondere auf einen niedrigen Energieverbrauch im Deep-Sleep-Modus Wert 
gelegt wurde. Für die Umsetzung wurde ein Firebeetle 2 ESP32 Mikrocontroller ausgewählt, der durch seine 
hohe Energieeffizienz überzeugt. Ergänzend wurde ein Gehäuse entwickelt, das sich nahtlos in die bestehende 
Wandhalterung für digitale Raumbelegungspläne der HTW einfügt und die Hardwarekomponenten zuverlässig schützt.

Die Implementierung umfasste sowohl die Anpassung der Software an die neue Hardware als auch die Fertigung 
des Gehäuses mittels Lasercutter. Die Validierung des Prototyps erfolgte durch Messungen 
der Leistungsaufnahme und Funktionstests im realen Umfeld. Die Ergebnisse zeigen, dass mit dem entwickelten 
Ansatz eine theoretische Laufzeit von etwa einem Jahr erreicht werden kann, wodurch die Anforderungen an eine 
energieeffiziente und wartungsarme Lösung erfüllt werden. Abschließend werden Optimierungspotenziale sowie 
Perspektiven für die Weiterentwicklung, wie etwa die Integration von Photovoltaikzellen, diskutiert.
\end{abstract}

\newpage


% Seitenzahlen ab hier in römischen Zahlen
\cleardoublepage
\pagenumbering{roman}

% Inhaltsverzeichnis
\tableofcontents

\newpage

% Abbildungsverzeichnis
\listoffigures

% Tabellenverzeichnis
\listoftables

% Abkürzungsverzeichnis
\section*{Abkürzungsverzeichnis}
\begin{description}
    \item[MQTT] Message Queuing Telemetry Transport
    \item[BUS-Spannung] Spannung am Eingang des Strommonitoring-Chips 
    \item[Shunt-Spannung] Spannungsabfall über dem Shunt-Widerstand, der proportional zum gemessenen Strom ist 
\end{description}


% Seitenzahlen ab Einleitung in arabischen Zahlen, beginnend mit 1
\clearpage
\pagenumbering{arabic}

\section{Einführung}
\subsection{Einleitung}

Im Hinblick auf die zunehmenden Anforderungen an Energieeffizienz und nachhaltige Systemkonzepte, gewinnt der Entwicklungsbedarf energieautarker 
elektronischer Systeme zunehmend an Bedeutung. 
Besonders im Bereich batteriegetriebener IoT-Anwendungen, stellt die begrenzte Lebensdauer von Energiespeichern eine zentrale Herausforderung dar. 
Wartungskosten, Batteriewechsel und ökologische Aspekte sprechen für alternative oder ergänzende Energieversorgungskonzepte.

Eine vielversprechende Möglichkeit stellt die Nutzung photovoltaischer Energiegewinnung unter Indoor-Lichtbedingungen dar. 
Moderne Dünnschicht-Solarzellen ermöglichen selbst bei vergleichsweise geringer Beleuchtungsstärke eine nutzbare Leistungsabgabe. 
Ob und in welchem Umfang diese Energie ausreicht, um ein energieoptimiertes System dauerhaft oder teilweise autark zu betreiben, 
ist jedoch stark anwendungsabhängig und erfordert eine systematische Untersuchung.

\subsection{Motivation}

Im ersten Projektsemester wurde ein erster Prototyp eines digitalen Raumbelegungsplans entwickelt, der auf einem E-Ink-Display basiert. 
Der Fokus lag dabei auf der Entwicklung eines energieeffizienten Systems, das eine lange Laufzeit ermöglicht.
In einer ersten theoretischen Analyse konnte für einen 1000 mAh 3,7 V Akku eine Laufzeit von etwa einem Jahr prognostiziert werden, 
was eine signifikante Verbesserung gegenüber bisherigen Prototypen darstellt.
Der daraus resultierende Energiebedarf lag bei etwa 70,66 mWh pro Woche, was einer mittleren Leistungsaufnahme von etwa 0,42 mWh pro Stunde entspricht. 
Eine erste Langzeitmessung über den Zeitraum vom 23.10.2025 bis zum 13.02.2026 liegt vor. Eine vorläufige Sichtung der Daten deutet darauf hin, 
dass die Laufzeit länger sein könnte als in der theoretischen Prognose erwartet.
Aufgrund dieses vielversprechenden Ergebnisses soll eine mögliche Integrierung von Photovoltaikzellen zur weiteren Verlängerung der Laufzeit 
untersucht werden.

\subsection{Zielsetzung}

Ziel dieser Arbeit ist die Entwicklung eines energieautarken Versorgungskonzepts mittels Photovoltaikzellen für den im ersten Projektsemester 
entwickelten digitalen Raumbelegungsplan und andere IoT-Anwendungen, die unter ähnlichen Bedingungen betrieben werden. Dabei liegt der Fokus auf einer 
maximalen Energieeffizienz, um die Laufzeit des Systems zu verlängern und den Wartungsaufwand zu minimieren. Das System soll dabei so konzipiert werden, 
dass es unabhängig vom digitalen Raumbelegungsplan betrieben werden kann, um eine flexible Integration in verschiedene Anwendungsbereiche zu ermöglichen. 
Der Formfaktor des Systems soll jedoch so gestaltet werden, dass eine nahtlose Integration in den Prototyp des digitalen Raumbelegungsplans möglich ist.
Im Anschluss soll geprüft werden, in welchem Umfang die Photovoltaikmodule unter normalen Innenlichtbedingungen Energie liefern und ob diese den 
Verbrauch des Systems langfristig decken oder die Batterielaufzeit messbar verlängern können.

\subsection{Methodik}
Zu Beginn soll eine umfassende Analyse der Energieverbrauchsmessungen des bisherigen Prototyps durchgeführt werden, um den tatsächlichen 
Energiebedarf zu ermitteln. Anschließend erfolgt eine Recherche zu geeigneten Photovoltaikzellen, die unter schlechten Lichtbedingungen eine 
möglichst hohe Energiegewinnung ermöglichen. Ist eine geeignete Zelle gefunden, muss ein dazu passender Laderegler ausgewählt werden. 
Dieser soll die Energie der Photovoltaikzelle effizient in den Akku einspeisen und gleichzeitig eine Überladung verhindern. Nachdem ein passendes 
System von Photovoltaikzelle und Laderegler ausgewählt wurde, muss eine kontinuierliche Messung der Stromgewinnung zwischen Laderegler und Akku umgesetzt 
werden, um die Effektivität der Energiegewinnung zu bewerten. Dazu muss ein geeigneter Strommonitoring-Chip ausgewählt und in die bestehende 
Hardware integriert werden. Abschließend soll eine Schnittstelle umgesetzt werden, die es ermöglicht, die gewonnenen Daten zur Energiegewinnung und zum 
Energieverbrauch zu überwachen und auszuwerten.

\section{Analyse}

\subsection{Laufzeitmessung des digitalen Raumbelegungsplans}
Eine Laufzeitmessung des digitalen Raumbelegungsplans wurde über den Zeitraum vom 23.10.2025 bis zum 13.02.2026 durchgeführt. Die Messung erfolgte über eine 
in Node-Red implementierte Schnittstelle, die für jede Aktualisierungsanfrage des digitalen Raumbelegungsplans die aktuelle Uhrzeit und die derzeitige Batteriespannung 
in eine Textdatei schreibt. Innerhalb dem Messzeitraum von 114 Tagen wurden 416 Aktualisierungsanfragen durchgeführt. In dieser Zeit ist die Batteriespannung 
von 4,05 V auf 3,96 V gesunken (Abbildung \ref{fig:battery_voltage}). 

\begin{figure}[H]
    \centering
    \includegraphics[width=1\textwidth]{../images/battery_voltage.png}
    \caption{Batteriespannung über die Zeit}
    \label{fig:battery_voltage}
\end{figure}

Über folgende Formel kann der anteilige Kapazitätsverlust $\Delta Q$ approximiert werden, wobei $U_\text{max}$ der maximalen Spannung, $U_\text{min}$ der minimalen Spannung, 
$U_\text{start}$ der Startspannung und $U_\text{end}$ der Endspannung entspricht:
\[
\Delta Q = \frac{U_\text{start} - U_\text{end}}{U_\text{max} - U_\text{min}}
= \frac{4.05 - 3.96}{4.2 - 3.2}
= \frac{0.09}{1.0} 
= 0.09
\]

Dies entspricht einem Kapazitätsverlust von etwa 9\% über den Zeitraum von 114 Tagen. Dadurch könnte die hochgerechnete Laufzeit des Systems bei etwa 1266 Tagen liegen, 
was etwa 3,5 Jahren entspricht. Es ist jedoch zu beachten, dass dies eine theoretische Prognose ist und die tatsächliche Laufzeit von verschiedenen Faktoren beeinflusst 
werden kann, wie z.B. der Alterung der Batterie, der Umgebungstemperatur und Selbstentladung. Ebenfalls geht die verwendete Formel von einem linearen Zusammenhang zwischen 
Spannung und Kapazität aus, was in der Praxis nicht der Fall ist. Jedoch deutet die Messung darauf hin, dass die Laufzeit des Systems länger 
sein könnte als in der theoretischen Prognose erwartet, was auf eine gute Energieeffizienz des Prototyps hindeutet.
Ein möglicher Erklärungsansatz für die längere Laufzeit liegt darin, dass die theoretische Prognose auf der konservativen Annahme basiert, wonach die Wachzeit des digitalen
Raumbelegungsplans 9 Minuten pro Woche beträgt. Eine Überschätzung der Wachzeit hat einen erheblichen Einfluss auf den berechneten Energieverbrauch, da der Energiebedarf 
im Wachmodus im Vergleich zum Deep-Sleep-Modus um etwa den Faktor 10 000 höher liegt. Ebenfalls könnte der Energieverbrauch in der Wachzeit geringer sein als angenommen, 
was ebenfalls zu einer längeren Laufzeit führen könnte.

\newpage

\subsection{Photovoltaikzellen für Innenlichtbedingungen}
Die Analyse zu geeigneten Photovoltaikzellen für Innenlichtbedingungen ergab, dass Dünnschicht-Solarzellen, insbesondere solche auf Basis von amorphem Silizium oder 
organischen Materialien, eine vielversprechende Option darstellen. Diese Zellen sind in der Lage, auch bei geringer Beleuchtungsstärke eine nutzbare Leistung zu 
liefern. \cite{TransparentThinFilmSiliconSolarCells, D2YA00075J} In diesem Bereich gibt es bereits kommerzielle Produkte, die speziell für den Einsatz unter 
Innenlichtbedingungen entwickelt wurden. Folgende Kriterien wurden bei der Auswahl berücksichtigt:
\begin{itemize}
    \item Energieeffizienz bei geringer Beleuchtungsstärke
    \item Kosten und Verfügbarkeit
    \item Größe und Formfaktor
\end{itemize}
Basierend auf diesen Kriterien wurden mehrere Kandidaten untersucht. Folgende Photovoltaikzellenanbieter wurden als potenzielle Optionen identifiziert:
\begin{itemize}
    \item Epishine – Indoor-Solarzellen \cite{EpishineIndoorSolarCells}
    \item PowerFilm – Indoor-Light-Module \cite{PowerFilmIndoorSeries}
    \item Panasonic – Amorton \cite{PanasonicAmorton}
\end{itemize}

Diese Zellen besitzen alle eine hohe Effizienz bei geringer Beleuchtungsstärke und sind für den Einsatz in Innenräumen geeignet. Jeder Anbieter bietet verschiedene Modelle 
mit unterschiedlichen Leistungsstufen und Größen an, die je nach den Anforderungen des Projekts ausgewählt werden können. In Bezug auf die Verfügbarkeit sind die Produkte 
von PowerFilm und Panasonic leichter zugänglich, wobei PowerFilm schnellere Lieferzeiten bietet. Die Produkte von Epishine sind zwar vielversprechend, aber derzeit nur über eine direkte Anfrage erhältlich, was die 
Beschaffung erschwert. Die Kosten sind bei den Anbietern PowerFilm und Panasonic vergleichbar. Letztlich wurde die Entscheidung getroffen, die Produkte
von PowerFilm zu verwenden, da sie eine gute Balance zwischen Effizienz, Verfügbarkeit und Kosten bieten. Es wurden verschiedene Modelle von PowerFilm untersucht, um die 
am besten geeignete Option für das Projekt zu identifizieren. Die INP-Modelle liefern eine Leistung von 10–30 µW bei einer Beleuchtungsstärke von 200 Lux, was für die Anforderungen 
des Projekts zu wenig sein könnte. Die INP-100-Modelle liefern eine Leistung von 100 µW bei 200 Lux, was ausreichend sein sollte, um den Energiebedarf des Systems zu decken. 
Die LL200-Modelle sind deutlich größer und liefern eine dementsprechend größere Leistung. Hervorstechend war das Modell LL200-3.6-75, da dieses eine Leistung von 206 µW bei 
200 Lux liefert. Ebenfalls liegt die Betriebsspannung bei 2,4 V, was höher als bei anderen Modellen der Reihe ist. Die Betriebsspannung ist ein wichtiger Faktor, da sie die 
Effizienz der Energiegewinnung beeinflussen kann. insbesondere für den Laderegler, der die Energie der Photovoltaikzelle in den Akku einspeist, ist es wichtig, dass die 
Betriebsspannung der Zelle ausreichend hoch ist, um eine effiziente Ladung zu ermöglichen. Aus diesen Gründen wurde die PowerFilm LL200-3.6-75 als die am besten geeignete 
Option für das Projekt ausgewählt (Abbildung \ref{fig:photovoltaik_zelle}).

\begin{figure}[H]
    \centering
    \includegraphics[width=.3\textwidth]{../images/zelle.png}
    \caption{PowerFilm LL200-3.6-75 Photovoltaikzelle}
    \label{fig:photovoltaik_zelle}
\end{figure}

\subsection{Laderegler für Photovoltaikzellen}
Die Analyse zu geeigneten Ladereglern für die ausgewählte Photovoltaikzelle ergab, dass es verschiedene Optionen gibt, die für die Anforderungen des Projekts geeignet sein 
könnten. Ein Laderegler ist notwendig, um die Energie der Photovoltaikzelle effizient in den Akku einzuspeisen und gleichzeitig eine Überladung zu verhindern.
Bei der Auswahl eines Ladereglers wurden folgende Kriterien berücksichtigt:
\begin{itemize}
    \item Kompatibilität mit der Betriebsspannung der Photovoltaikzelle
    \item Effizienz der Energieumwandlung
    \item Kosten und Verfügbarkeit
    \item Größe und Formfaktor
\end{itemize}
Basierend auf diesen Kriterien wurden mehrere Kandidaten untersucht. Folgende Laderegler wurden als potenzielle Optionen identifiziert:
\begin{itemize}
    \item Texas Instruments – BQ25570 \cite{BQ25570}
    \item Analog Devices – LTC3105 \cite{LTC3105}
    \item Analog Devices – MAX17222 \cite{MAX17222}
\end{itemize}

Der BQ25570 ist speziell für Energy-Harvesting-Anwendungen entwickelt worden. Er besitzt eine sehr niedrige Startspannung (330 mV) und integriertes MPPT. 
Zusätzlich enthält er einen Abwärtswandler zur Versorgung der Last. Aufgrund des sehr geringen Eigenverbrauchs eignet er sich besonders für Systeme mit extrem niedriger 
Leistungsaufnahme. Es gibt verschiedene Breakout-Boards, die den BQ25570 verwenden, was die Implementierung erleichtert. Die Verfügbarkeit ist gut und die Kosten sind 
moderat, was ihn zu einer attraktiven Option für das Projekt macht. Die Größe des gängisten Breakout-Boards ist mit etwa 26,5 mm x 28 mm relativ kompakt, was für die 
Integration in das bestehende System vorteilhaft ist. \cite{BQ25570Breakout}
Der LTC3105 ist ein Aufwärtswandler mit integriertem MPPT. Er kann bereits bei sehr niedrigen Eingangsspannungen arbeiten und bietet einen relativ hohen Ausgangsstrom. 
Allerdings ist sein Eigenverbrauch höher als beim BQ25570, wodurch er sich eher für Anwendungen mit etwas höherer verfügbarer Leistung eignet. Leider ist der LTC3105 
nicht mit einem passenden Breakout-Board erhältlich, was die Implementierung erschwert. Die Verfügbarkeit des LTC3105 ist gut, aber die Kosten sind höher als beim BQ25570.
Der MAX17222 ist ein stromsparender Boost-Converter mit sehr geringem Ruhestrom im Nanoamperebereich. Er besitzt jedoch keine integrierte Lade- und MPPT-Logik. 
Daher müsste eine zusätzliche Beschaltung implementiert werden, um eine optimale Energieausbeute sicherzustellen. Ebenfalls ist die Verfügbarkeit des MAX17222 eingeschränkt, 
was die Beschaffung erschwert. Ein Breakout-Board für den MAX17222 konnte nicht gefunden werden, was die Implementierung weiter erschwert. 
Aufgrund dieser Faktoren wurde der BQ25570 als die am besten geeignete Option für das Projekt ausgewählt (Abbildung \ref{fig:BQ25570_Vorderseite} und \ref{fig:BQ25570_Vorderseite}).

\begin{figure}[H]
    \centering
    \begin{minipage}[b]{0.45\textwidth}
        \centering
        \includegraphics[width=\textwidth]{../images/BQ25570_Vorderseite.png}
        \caption{Texas Instruments BQ25570 Laderegler Vorderseite}
        \label{fig:BQ25570_Vorderseite}
    \end{minipage}
    \hspace{0.05\textwidth}
    \begin{minipage}[b]{0.45\textwidth}
        \centering
        \includegraphics[width=\textwidth]{../images/BQ25570_Rückseite.png}
        \caption{Texas Instruments BQ25570 Laderegler Rückseite}
        \label{fig:BQ25570_Rückseite}
    \end{minipage}
\end{figure}


\subsection{Strommesssystem zur Überwachung der Energiegewinnung}
Neben der eigentlichen Energiegewinnung ist es wichtig, den Stromfluss zwischen Laderegler und Akku kontinuierlich zu überwachen, um die Effektivität 
der Energiegewinnung zu bewerten. Dazu muss ein geeigneter Strommonitoring-Chip ausgewählt und in die bestehende Hardware integriert werden.
Die Analyse ergab, dass es verschiedene Optionen gibt, die für die Anforderungen des Projekts geeignet sein könnten. Bei der Auswahl eines Strommonitoring-Chips 
wurden folgende Kriterien berücksichtigt:
\begin{itemize}
    \item Messbereich und Genauigkeit
    \item Kompatibilität mit der bestehenden Hardware
    \item Kosten und Verfügbarkeit
    \item Größe und Formfaktor
\end{itemize}
Basierend auf diesen Kriterien wurden mehrere Kandidaten untersucht. Folgende Strommonitoring-Chips wurden als potenzielle Optionen identifiziert:
\begin{itemize}
    \item Texas Instruments – INA226 \cite{INA226}
    \item Maxim Integrated – MAX471 \cite{MAX471}
    \item Analog Devices – AD8210 \cite{AD8210}
\end{itemize}

Der INA226 ist ein digitaler Strom- und Leistungsmonitor mit integrierter 16-Bit-ADC und I²C-Schnittstelle. Er ermöglicht die gleichzeitige Messung von 
Shunt-Spannung, Busspannung, Strom und Leistung. Durch die hohe Auflösung und die Möglichkeit, den Shunt-Widerstand frei zu wählen, kann der Messbereich 
optimal auf sehr kleine Ströme angepasst werden. Zudem sind kostengünstige Breakout-Module verfügbar, was die Integration in das bestehende System vereinfacht.
Der Formfaktor des gängisten Breakout-Moduls ist mit etwa 20 mm x 27 mm relativ kompakt. \cite{INA226Breakout}
Der MAX471 ist ein analoger High-Side-Strommessverstärker mit integriertem Shunt-Widerstand. Obwohl er einfach zu implementieren ist, ist er primär für höhere 
Ströme ausgelegt. Die interne Widerstandsdimensionierung sowie der analoge Ausgang begrenzen die Auflösung im Mikroamperebereich. Es gibt eine gute Verfügbarekeit 
kostengünstiger Breakout-Boards für den MAX471. Die Größe der gängigsten Breakout-Boards liegt bei etwa 19,5 mm x 20,3 mm und ist damit kompakter als das INA226 
Breakout-Board. \cite{MAX471Breakout}
Der AD8210 ist ein präziser, bidirektionaler Strommessverstärker mit hoher Gleichtaktspannungsfestigkeit. Er eignet sich vor allem für industrielle Anwendungen 
mit höheren Spannungen. Da es sich jedoch um eine rein analoge Lösung handelt, ist ein externer ADC erforderlich, um digitale Messwerte zu erhalten. Dies 
erhöht die Komplexität und den Hardwareaufwand. Die Verfügbarkeit des AD8210 ist gut, aber die Kosten sind höher als bei den anderen Optionen. Ein Breakout-Board 
für den AD8210 konnte nicht gefunden werden, was die Implementierung weiter erschwert. 
Aufgrund dieser Faktoren wurde der INA226 als die am besten geeignete Option für das Projekt ausgewählt (Abbildung \ref{fig:INA226}).

\begin{figure}[H]
    \centering
    \includegraphics[width=.3\textwidth]{../images/INA226.png}
    \caption{Texas Instruments INA226 Strommonitoring-Chip}
    \label{fig:INA226}
\end{figure}

\section{Konzeption}

\subsection{Photovoltaik-System}
Die in der Analyse identifizierten Komponenten, bestehend aus der PowerFilm LL200-3.6-75 Photovoltaikzelle und dem Texas Instruments BQ25570 Laderegler 
bilden die Grundlage für die Konzeption eines energieautarken Versorgungskonzepts. Wie in der Zielsetzung beschrieben, soll das System so konzipiert werden, 
dass es unabhängig vom digitalen Raumbelegungsplan betrieben werden kann, jedoch vom Formfaktor her so gestaltet ist, dass eine nahtlose Integration in den 
Prototyp des digitalen Raumbelegungsplans möglich ist. Die untere Freifläche des Gehäuses soll dabei für die Integration der Photovoltaikzelle genutzt werden
(Abbildung \ref{fig:Prototyp_final}). Diese Fläche besitzt eine Größe von etwa 160 mm x 180 mm, was ausreichend Platz für die Integration von vier 
PowerFilm LL200-3.6-75 Zellen bietet. Eine Parallelschaltung der vier Zellen würde dabei bei 200 Lux eine Leistung von etwa 824 µW liefern.

\begin{figure}[H]
    \centering
    \includegraphics[width=.3\textwidth]{../images/Prototyp_final.jpg}
    \caption{Finaler Prototyp des digitalen Raumbelegungsplans}
    \label{fig:Prototyp_final}
\end{figure}

Die vier Photovoltaikzellen werden an den IN+ und IN- Anschlüssen des BQ25570 Ladereglers angeschlossen. Die BAT+ und BAT- Anschlüsse des Ladereglers werden 
mit einem 1000 mAh 3,7 V Li-Ionen-Akku verbunden, um die erzeugte Energie zu speichern. Der OUT+ und OUT- Anschluss des Ladereglers kann optional genutzt werden, um die Energie direkt 
an die Last zu liefern, falls dies erforderlich ist. Entsprechende IoT Anwendungen können dann über die OUT-Anschlüsse mit Energie versorgt werden, 
während der Akku als Puffer dient, um eine kontinuierliche Energieversorgung sicherzustellen (Abbildung \ref{fig:Schematic_Photovoltaic}).

\begin{figure}[H]
    \centering
    \includegraphics[width=.8\textwidth]{../images/Schematic_Photovoltaic.png}
    \caption{Schematische Darstellung des Photovoltaik-Systems}
    \label{fig:Schematic_Photovoltaic}
\end{figure}

\subsection{Strommesssystem}
Um die Effektivität der Energiegewinnung zu bewerten, soll eine Schnittstelle umgesetzt werden, die es ermöglicht, diese zu überwachen und auszuwerten. Dazu wird 
der Texas Instruments INA226 Strommonitoring-Chip verwendet. Dieser Chip muss mit einem Mikrocontroller 
verbunden werden, der die Messdaten ausliest. Dazu geeignet ist jeglicher Mikrocontroller, der über eine I²C-Schnittstelle verfügt, wie z.B. der bereits im digitalen 
Raumbelegungsplan verwendete Firebeetle 2 ESP32. Dieser Mikrocontroller bietet die Möglichkeit über eine WLAN-Verbindung die gesammelten Daten an einen Server zu 
senden, wo sie gespeichert und analysiert werden können. Ebenfalls beinhaltet der ESP32 einen integrierten Anschluss für einen Akku, wodurch die Messung auch ohne 
externe Stromversorgung möglich ist. Dazu kann ebenfalls ein 1000 mAh 3,7 V Li-Ionen-Akku verwendet werden (Abbildung \ref{fig:Schematic_Currentmeasure}). 

\begin{figure}[H]
    \centering
    \includegraphics[width=.8\textwidth]{../images/Schematic_Currentmeasure.png}
    \caption{Schematische Darstellung des Strommesssystems}
    \label{fig:Schematic_Currentmeasure}
\end{figure}

Damit die Messungen der Stromgewinnung möglichst genau sind, muss der Shunt-Widerstand des INA226 entsprechend dimensioniert werden. Ziel ist es, Ströme mit einer 
hohen Präzision im Mikroamperebereich messen zu können und gleichzeitig zu vermeiden, dass der Spannungsabfall über dem Shunt-Widerstand zu hoch wird, da dies 
die Energiegewinnung beeinträchtigen und für einen thermischen Drift sorgen könnte.
Die Auflösung des INA226 beträgt 2,5 µV pro Bit.\cite{INA226} Um eine Auflösung von 1 µA zu erreichen, muss der 
Shunt-Widerstand so gewählt werden, dass 1 µA einen Spannungsabfall von mindestens 2,5 µV verursacht. Mit folgender Formel kann der benötigte 
Shunt-Widerstand $R_{\text{shunt}}$ berechnet werden, wobei $V_{\text{LSB}}$ die Auflösung des INA226 und $I_{\text{target}}$ der Zielstrom ist:
\[
R_{\text{shunt}} = \frac{V_{\text{LSB}}}{
I_{\text{target}}} = \frac{2.5 \, \mu\text{V}}{1 \, \mu\text{A}} = 2.5 \, \Omega
\]

Ein Shunt Widerstand von 2,5 \(\Omega\) ermöglicht es bereits Ströme mit einer Auflösung von 1 µA zu messen. Um jedoch eine höhere Präzision zu erreichen, wird ein 
Shunt-Widerstand von 10 \(\Omega\) verwendet, wodurch eine Auflösung von 0,25 µA erreicht werden kann. Der Standardmäßige Shunt-Widerstand auf dem INA226 Breakout-Board 
beträgt 0,01 \(\Omega\), weshalb dieser durch einen 10 \(\Omega\) Widerstand ersetzt werden muss, um die gewünschte Auflösung zu erreichen.

Als Proggramiersprache für den Firebeetle 2 ESP32 kann MicroPython verwendet werden, da diese eine einfache und effiziente Möglichkeit bietet, die benötigte Funktionalität 
zu implementieren. Ebenfalls ist dies eine Sprache die im ersten Projektsemester bereits verwendet wurde, wodurch die Implementierung erleichtert wird.
Der Mikrocontroller soll so programmiert werden, dass er alle 60 Sekunden aufwacht und über einen AO3401 P-channel MOSFET die Stromversorgung des INA226 
aktiviert. Der verwendete MOSFET soll eine längere Akkulaufzeit des Firebeetle 2 ESP32 ermöglichen, indem er die Stromversorgung des INA226 nur dann aktiviert, wenn eine 
Messung durchgeführt wird. Ebenfalls befindet sich der Mikrocontroller im Deep-Sleep-Modus, wenn keine Messung durchgeführt wird, um den Energieverbrauch weiter zu minimieren.
In der Wachphase soll der Firebeetle 2 ESP32 drei mal aufeinanderfolgend mit einer Sekunde Pause die Messdaten 
des INA226 auslesen. Zu den Messdaten zählen neben der Stromstärke auch die BUS-Spannung und die Shunt-Spannung. Anschließend soll der Median der drei Messungen berechnet 
werden, um Ausreißer zu minimieren. Die gesammelten Daten sollen über eine WLAN-Verbindung 
an einen MQTT-Broker gesendet werden. Eine Node-Red Instanz kann anschließend die Daten vom MQTT-Broker anfragen und für die langfristige Speicherung in einer 
InfluxDB-Datenbank aufbereiten. Innerhalb von InfluxDB können die Daten dann analysiert und visualisiert werden, um die Effektivität der Energiegewinnung 
zu bewerten und mögliche Optimierungspotenziale zu identifizieren. Ebenfalls ist eine exportierbare CSV-Datei generierbar, um die Daten auch in anderen Tools 
weiterverarbeiten zu können (Abbildung \ref{fig:sequence_diagram}).

% Add uxf diagram
\begin{figure}[H]
    \centering
    \includegraphics[width=1.\textwidth]{../images/sequence.png}
    \caption{UML-Sequenzdiagramm zur Darstellung der Interaktion zwischen den Komponenten des Strommesssystems}
    \label{fig:sequence_diagram}
\end{figure}

\subsection{Vereinigung von Photovoltaik- und Strommesssystem}
Die Vereinigung des Photovoltaik-Systems und des Strommesssystems erfolgt an der Schnittstelle zwischen Laderegler und Akku des Photovoltaik-Systems. 
Der Strommonitoring-Chip (INA226) wird dazu in Reihe mit dem Akku geschaltet, um den Stromfluss zu messen, der vom Laderegler zum Akku fließt. Der 
BAT+ Anschluss des Ladereglers wird mit dem VIN Anschluss des INA226 verbunden. Der VOUT Anschluss des INA226 wird mit dem positiven Pol des 
Akkus verbunden, während der negative Pol des Akkus mit dem BAT- Anschluss des Ladereglers verbunden wird. Dadurch kann der INA226 den Strom messen, 
der vom Laderegler zum Akku fließt, ohne die Funktionalität des Ladereglers zu beeinträchtigen (Abbildung \ref{fig:Schematic_combined}).

\begin{figure}[H]
    \centering
    \includegraphics[width=.65\textwidth]{../images/Schematic_combined.png}
    \caption{Schematische Darstellung der Vereinigung von Photovoltaik- und Strommesssystem}
    \label{fig:Schematic_combined}
\end{figure}

\newpage

\section{Technische Umsetzung}

\subsection{Photovoltaik-System}
Die technische Umsetzung des Photovoltaik-Systems umfasste die Beschaffung der ausgewählten Komponenten und das physische Verbinden der Photovoltaikzellen mit dem 
Laderegler und dem Akku. Die vier PowerFilm LL200-3.6-75 Photovoltaikzellen wurden in Parallelschaltung verbunden, damit die Beschattung einzelner 
Zellen die Gesamtleistung nicht zu stark beeinträchtigt. Die Zellen wurden mit den IN+ und IN- Anschlüssen des BQ25570 Ladereglers und die BAT+ und BAT- 
mit dem Akku verlötet. Eine erste Messung über einen Multimeter bestätigte, dass bei Raumbeleuchtung ein messbarer Stromfluss vom Laderegler zum Akku stattfindet, 
was darauf hindeutet, dass die Photovoltaikzellen Energie erzeugen und der Laderegler diese Energie in den Akku einspeist.

\subsection{Strommesssystem}

\subsubsection{Hardware-Implementierung des Strommesssystems}
Zuerst wurde der vorhandene Shunt-Widerstand auf dem INA226 Breakout-Board durch einen 10 \(\Omega\) Widerstand ersetzt, um die gewünschte Auflösung von 
0,25 µA zu erreichen (Abbildung \ref{fig:INA226_shunt}). Es handelt sich bei dem verrwendeten Shunt nicht um einen Präzisionswiderstand, weshalb im späteren
Verlauf Kalibrierungen durchgeführt wurden, um die Messgenauigkeit zu verbessern.

\begin{figure}[H]
    \centering
    \includegraphics[width=.3\textwidth]{../images/INA226_shunt.png}
    \caption{INA226 Breakout-Board mit ersetztem Shunt-Widerstand}
    \label{fig:INA226_shunt}
\end{figure}

Anschließend wurde der INA226 Strommonitoring-Chip mit dem Firebeetle 2 ESP32 Mikrocontroller verbunden. Dazu 
wurde ein Prototype-Board verwendet, um die Verbindungen herzustellen. SDA und SCL des INA226 wurden mit den entsprechenden Pins des ESP32 verbunden, um die 
I²C-Kommunikation zu ermöglichen. Der AO3401 P-channel MOSFET wurde ebenfalls in die Schaltung integriert, um die Stromversorgung des INA226 zu steuern. Der
Gate des MOSFETs wurde mit einem GPIO-Pin des ESP32 verbunden, um diesen über die Software zu steuern (Abbildung \ref{fig:Strommess_vorderseite}, 
\ref{fig:Strommess_rueckseite}).

\begin{figure}[H]
    \centering
    \begin{minipage}[b]{0.45\textwidth}
        \centering
        \includegraphics[height=8cm]{../images/Vorderseite-Strommesser.jpg}
        \caption{Vorderseite des Strommesssystems}
        \label{fig:Strommess_vorderseite}
    \end{minipage}
    \hspace{0.05\textwidth}
    \begin{minipage}[b]{0.45\textwidth}
        \centering
        \includegraphics[height=8cm]{../images/Rückseite-Strommesser.jpg}
        \caption{Rückseite des Strommesssystems}
        \label{fig:Strommess_rueckseite}
    \end{minipage}
\end{figure}

\subsubsection{Software-Implementierung des Strommesssystems}
Für die Software-Implementierung des Strommesssystems wurde MicroPython verwendet. Der Code wurde so strukturiert, dass es eine main.py Datei gibt, welche 
die Hauptlogik des Programms enthält. Die Datei current\_reader.py enthält die Hauptfunktionen zum Auslesen der Messdaten vom INA226, zum 
Berechnen des Medians der Messungen und zum Steuern des AO3401 MOSFETs, um die Stromversorgung des INA226 zu aktivieren oder zu deaktivieren.
Die Kommunikation mit dem INA226 Modul erfolgt über eine Bibliothek von elschopi.\cite{elschopi_TI_INA226_micropython_2020} Weitere Dateien 
enthalten Funktionen zum Herstellen der WLAN-Verbindung, zum Senden der Daten 
an den MQTT-Broker, zum Berechnen der Batteriespannung und zum Einleiten des Deep-Sleep-Modus.

Der Ablauf im Hauptprogramm sieht dabei wie folgt aus:
\begin{itemize}
    \item Der Mikrocontroller wacht alle 60 Sekunden auf 
    \item CurrentReader wird instanziiert
    \item Der AO3401 MOSFET c aktiviert, um die Stromversorgung des INA226 zu ermöglichen.
    \item Internet und MQTTClient werden instanziiert, um die WLAN-Verbindung herzustellen und die Daten an den MQTT-Broker zu senden.
    \item Es werden drei Messungen der Stromstärke, BUS-Spannung und Shunt-Spannung durchgeführt, wobei zwischen den Messungen eine Sekunde gewartet wird.
    \item Der Median der Messungen wird berechnet.
    \item Die Batteriespannung wird berechnet, um den Kapazitätsverlust der Batterie zu überwachen.
    \item Stromstärke, BUS-Spannung, Shunt-Spannung und Batteriespannung werden in einem JSON-Objekt formatiert.
    \item Das JSON-Objekt wird über eine WLAN-Verbindung an einen MQTT-Broker gesendet.
    \item Der AO3401 MOSFET wird deaktiviert, um die Stromversorgung des INA226 zu unterbrechen.
    \item Der Mikrocontroller geht in den Deep-Sleep-Modus, um den Energieverbrauch zu minimieren, bis der nächste Messzyklus beginnt.
\end{itemize}

Zur Kalibrierung der Messdaten wurde mit dem Transimpedanzverstärker DLPCAS-S6 der Firma FEMTO die Stromstärke bei verschiedenen 
angelegten Spannungen an einem Widerstand von 10 k\(\Omega\) gemessen.  Die Spannungen wurden mit einer Schrittweite von 1 V zwischen 
1 V und 10 V angelegt. Duch die Formel \(I = \frac{U}{R}\) konnte die theoretische Stromstärke berechnet werden.

% create table with columns: Applied Voltage, Theoretical Current, Measured Current FEMTO, Measured Current INA226, Deviation FEMTO, Deviation INA226
\begin{table}[H]
    \centering
    \begin{tabularx}{\textwidth}{|Y|C|Z|Z|Y|Y|}
        \hline
        Angelegte Spannung (V) & Theoretische Stromstärke (mA) & Gemessene Stromstärke FEMTO (mA) & Gemessene Stromstärke INA226 (mA) & Abweichung FEMTO (\%) & Abweichung INA226 (\%) \\
        \hline
        1  & 0.1 & 0.09999 & 0.09999 & -0.01 & -0.01 \\
        2  & 0.2 & 0.19924 & 0.20099 & -0.38 & 0.50 \\
        3  & 0.3 & 0.29855 & 0.29912 & -0.48 & -0.29 \\
        4  & 0.4 & 0.39790 & 0.40026 & -0.53 & 0.07 \\
        5  & 0.5 & 0.49718 & 0.49939 & -0.56 & -0.12 \\
        6  & 0.6 & 0.59632 & 0.60304 & -0.61 & 0.51 \\
        7  & 0.7 & 0.69570 & 0.69972 & -0.61 & -0.04 \\
        8  & 0.8 & 0.79484 & 0.79484 & -0.65 & -0.65 \\
        9  & 0.9 & 0.89408 & 0.89408 & -0.66 & -0.66 \\
        10 & 1.0 & 0.99499 & 0.99334 & -0.50 & -0.67 \\
        \hline
    \end{tabularx}
    \caption{Kalibrierung der Messdaten des INA226 im Vergleich zum Transimpedanzverstärker DLPCAS-S6}
    \label{tab:calibration}
\end{table}


\newpage

\section{Erläuterung zur Nutzung von KI}

KI-Tools wurden in dieser Arbeit als assistives Werkzeug im Implementierungs- und Schreibprozess verwendet.
Im Schreibprozess diente ChatKI als Unterstützung für grobe Strukturierungsideen.
ChatGPT wurde genutzt, um Rechtschreib- und Grammatikfehler im Fließtext zu überprüfen und Verbesserungsvorschläge zu erhalten.
Ebenfalls wurde ChatGPT im Implementierungsprozess verwendet, um Fehler im Code zu finden.
Es wurden keine Inhalte ungeprüft übernommen. 

\newpage

\addcontentsline{toc}{section}{Literaturverzeichnis}
\bibliographystyle{plain}
\bibliography{quellen}

\end{document}